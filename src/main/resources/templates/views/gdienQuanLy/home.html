<!DOCTYPE html>
<html lang="vi"
    th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Trang Nh√¢n Vi√™n</title>
    </head>

    <body>
        <main class="homequanly">
            <div class="container py-4">
                <h2 class="mb-4 mt-4 fw-bold text-primary-custom">
                    üìä B·∫£ng ƒëi·ªÅu khi·ªÉn h·ªá th·ªëng
                </h2>

                <!-- Th·ªëng k√™ -->
                <div class="row g-4 mb-4 justify-content-center">
                    <div class="col-md-4">
                        <a th:href="@{/{p}/khoa-hoc-he-thong(p=${prefix})}"
                            style="text-decoration: none; color: inherit">
                            <div class="highlight-box text-center">
                                <h5>üìò KH√ìA H·ªåC ƒêANG M·ªû</h5>
                                <p th:text="${tongDaXuatBan}"></p>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a th:href="@{/{p}/quanly-giangvien(p=${prefix})}"
                            style="text-decoration: none; color: inherit">
                            <div class="highlight-box text-center">
                                <h5>üë®‚Äçüè´ T·ªîNG GI·∫¢NG VI√äN</h5>
                                <p th:text="${soGiangVien}"></p>
                            </div>
                        </a>
                    </div>

                    <div class="col-md-4">
                        <a th:href="@{/{p}/quanly-hocvien(p=${prefix})}"
                            style="text-decoration: none; color: inherit">
                            <div class="highlight-box text-center">
                                <h5>üéì T·ªîNG H·ªåC VI√äN</h5>
                                <p th:text="${tongHocVienDangKy}"></p>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Doanh thu theo th√°ng + Doanh thu qu√Ω n√†y (c√πng h√†ng) -->
                <div class="row g-4 mb-5 mt-3">
                    <!-- Doanh thu qu√Ω n√†y -->
                    <div class="col-md-3">
                        <a href="/admin/doanhthu"
                            style="text-decoration: none; color: inherit">
                            <div
                                class="highlight text-center h-100 d-flex flex-column">
                                <h5>üí∞ T·ªîNG DOANH THU</h5>

                                <!-- S·ªë ti·ªÅn -->
                                <p>
                                    <i class="bi bi-currency-dollar me-2"></i>
                                    <span
                                        th:text="${tongDoanhThu != null} ? ${#numbers.formatDecimal(tongDoanhThu, 0, 'COMMA', 0, 'POINT')} + ' VNƒê' : '0 VNƒê'">
                                    </span>
                                </p>

                                <!-- ·∫¢nh minh h·ªça -->
                                <img class="highlight-img mt-0"
                                    src="/photos/doanhthu3.png"
                                    alt="·∫¢nh doanh thu" />
                            </div>
                        </a>
                    </div>

                    <!-- Bi·ªÉu ƒë·ªì doanh thu theo th√°ng -->
                    <div class="col-md-9">
                        <div class="card shadow-sm p-4 h-100">
                            <h5 class="mb-4 text-warning fw-bold">
                                <i class="bi bi-currency-dollar me-2"></i>Doanh
                                thu theo th√°ng
                            </h5>
                            <canvas id="doanhThuChart" height="150"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Bi·ªÉu ƒë·ªì -->
                <div class="card shadow-sm p-4 mb-5">
                    <h5 class="mb-4 text-primary fw-bold">
                        <i class="bi bi-bar-chart-line me-2"></i>Top 5 kh√≥a h·ªçc
                        ƒë∆∞·ª£c h·ªçc vi√™n ƒëƒÉng k√Ω nhi·ªÅu nh·∫•t
                    </h5>
                    <canvas id="khoaHocChart" height="200"></canvas>
                </div>

                <!-- Bi·ªÉu ƒë·ªì tr√≤n & Nhi·ªám v·ª• h√¥m nay (tr√™n c√πng 1 h√†ng) -->
                <div class="row g-4 mb-5">
                    <!-- Nhi·ªám v·ª• h√¥m nay -->
                    <div class="col-md-6">
                        <div class="card modern-task-card shadow-lg h-100">
                            <div class="card-header modern-card-header">
                                <div class="header-content">
                                    <div class="header-icon">
                                        <i class="fas fa-clipboard-list"></i>
                                    </div>
                                    <div class="header-text">
                                        <h5 class="header-title">Nhi·ªám v·ª• h√¥m
                                            nay
                                        </h5>
                                        <p class="header-subtitle">Danh s√°ch c·∫ßn
                                            x·ª≠ l√Ω</p>
                                    </div>
                                </div>
                            </div>
                            <ul
                                class="list-group modern-list-group list-group-flush">
                                <li
                                    class="list-group-item modern-list-item d-flex justify-content-between align-items-center"
                                    th:each="khoaHoc : ${danhSach}">
                                    <div class="task-content">
                                        <div class="task-icon">
                                            <i class="fas fa-book"></i>
                                        </div>
                                        <span class="task-name"
                                            th:text="${khoaHoc.tenKhoaHoc}">L·∫≠p
                                            tr√¨nh Web Frontend v·ªõi
                                            React.js</span>
                                    </div>
                                    <a
                                        th:href="@{/kiem-duyet-khoa-hoc/{id}(id=${khoaHoc.khoahocId})}"
                                        class="modern-btn">
                                        <i class="fas fa-eye me-1"></i> Xem chi
                                        ti·∫øt
                                    </a>
                                </li>
                                <li
                                    class="list-group-item modern-empty-state text-center"
                                    th:if="${#lists.isEmpty(danhSach)}">
                                    <div class="empty-icon">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="empty-text">
                                        Kh√¥ng c√≥ kh√≥a h·ªçc c·∫ßn duy·ªát h√¥m nay
                                    </div>
                                    <div class="empty-emoji">üéâ</div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- Bi·ªÉu ƒë·ªì tr√≤n -->
                    <div class="col-md-6">
                        <div class="card shadow-sm p-4 h-100">
                            <h5 class="mb-4 text-success fw-bold">
                                <i class="bi bi-pie-chart me-2"></i>Bi·ªÉu ƒê·ªì T·ªâ
                                L·ªá Gi·∫£ng Vi√™n & H·ªçc Vi√™n
                            </h5>
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Nhi·ªám v·ª• v√† Th√¥ng b√°o -->
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card shadow-sm fixed-card">
                            <div
                                class="card-header card-header-custom d-flex justify-content-between align-items-center">
                                <span>üí≥ Giao d·ªãch g·∫ßn ƒë√¢y</span>
                                <a
                                    th:href="@{/{prefix}/quanly-giao-dich(prefix=${prefix})}"
                                    th:text="${prefix} == 'admin' ? 'Chi Ti·∫øt - Giao d·ªãch' : 'Chi ti·∫øt - Giao d·ªãch'">
                                </a>
                            </div>

                            <div class="card-body p-2">
                                <div
                                    th:if="${listGiaoDich == null or #lists.isEmpty(listGiaoDich)}"
                                    class="text-muted text-center py-3">
                                    <i class="fas fa-inbox fa-2x mb-2"></i><br>
                                    Kh√¥ng c√≥ giao d·ªãch n√†o.
                                </div>

                                <!-- Danh s√°ch giao d·ªãch -->
                                <div th:each="gd : ${listGiaoDich}"
                                    class="d-flex align-items-start mb-3 p-2 border rounded shadow-sm small bg-light">

                                    <!-- Icon -->
                                    <div class="me-2">
                                        <i
                                            class="fas fa-receipt text-success fa-lg"></i>
                                    </div>

                                    <!-- N·ªôi dung ch√≠nh + ti·ªÅn & tr·∫°ng th√°i -->
                                    <div
                                        class="flex-grow-1 d-flex justify-content-between">

                                        <!-- B√™n tr√°i: th√¥ng tin h·ªçc vi√™n -->
                                        <div>
                                            <div class="fw-bold"
                                                th:text="${gd.tenhocvien}">T√™n
                                                h·ªçc vi√™n</div>
                                            <div class="text-muted small"
                                                th:text="${gd.hinhThucThanhToan}">H√¨nh
                                                th·ª©c
                                            </div>
                                        </div>

                                        <!-- B√™n ph·∫£i: ti·ªÅn & tr·∫°ng th√°i -->
                                        <div class="text-end">
                                            <div class="fw-bold text-primary"
                                                th:text="${#numbers.formatDecimal(gd.tongtien, 0, 'COMMA', 2, 'POINT')} + ' ƒë'">
                                                0 ƒë
                                            </div>
                                            <div class="small">
                                                <span
                                                    th:switch="${gd.trangthai.name()}">
                                                    <span th:case="'HOAN_THANH'"
                                                        class="badge bg-success">Ho√†n
                                                        th√†nh</span>
                                                    <span th:case="'CHO_XU_LY'"
                                                        class="badge bg-warning text-dark">Ch·ªù
                                                        x·ª≠ l√Ω</span>
                                                    <span th:case="'THAT_BAI'"
                                                        class="badge bg-danger">Th·∫•t
                                                        b·∫°i</span>
                                                    <span th:case="*"
                                                        class="badge bg-secondary">Kh√¥ng
                                                        x√°c ƒë·ªãnh</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card shadow-sm fixed-card">
                            <div class="card-header card-header-custom">
                                üì¢ Th√¥ng b√°o h·ªá th·ªëng
                            </div>
                            <div class="card-body p-2">
                                <!-- N·∫øu kh√¥ng c√≥ th√¥ng b√°o -->
                                <div
                                    th:if="${danhSachThongBao == null or #lists.isEmpty(danhSachThongBao)}"
                                    class="text-muted text-center py-3">
                                    <i class="fas fa-inbox fa-2x mb-2"></i><br>
                                    Kh√¥ng c√≥ th√¥ng b√°o n√†o.
                                </div>

                                <!-- Danh s√°ch th√¥ng b√°o -->
                                <div th:each="tb : ${danhSachThongBao}"
                                    class="d-flex align-items-start mb-3 p-2 border rounded shadow-sm small bg-light">
                                    <div class="me-2">
                                        <i
                                            class="fas fa-bell text-warning fa-lg"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="fw-bold"
                                            th:text="${tb.tieuDe}">Ti√™u ƒë·ªÅ th√¥ng
                                            b√°o
                                        </div>
                                        <div class="text-muted small"
                                            th:text="${#temporals.format(tb.ngaygui,'dd/MM/yyyy')}">01/01/2024</div>
                                        <div class="text-dark small"
                                            style="max-width: 100%; white-space: normal; word-wrap: break-word;"
                                            th:utext="${tb.noiDung}">
                                            N·ªôi dung th√¥ng b√°o...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bi·ªÉu ƒë·ªì danh m·ª•c -->
                <div class="card shadow-sm p-4 mb-5 mt-5">
                    <h5 class="chart-title text-info fw-bold">
                        <i class="bi bi-diagram-3 me-2"></i>Bi·ªÉu ƒê·ªì Danh M·ª•c
                        Kh√≥a H·ªçc
                    </h5>
                    <canvas id="danhMucChart" height="250"></canvas>
                </div>
            </div>
            <!-- ChartJS -->
            <script
                src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
            <script th:inline="javascript">
            /*<![CDATA[*/
            const khoaHocLabels = /*[[${topKhoaHocLabels}]]*/ ["KH1", "KH2", "KH3", "KH4", "KH5"];
            const khoaHocData = /*[[${topKhoaHocSoLuong}]]*/ [30, 25, 22, 18, 15];

            const ctx = document.getElementById('khoaHocChart').getContext('2d');
            new Chart(ctx, {
                type: 'line', // üü¢ ƒê·ªïi sang bi·ªÉu ƒë·ªì ƒë∆∞·ªùng
                data: {
                    labels: khoaHocLabels,
                    datasets: [{
                        label: 'S·ªë l∆∞·ª£ng h·ªçc vi√™n',
                        data: khoaHocData,
                        fill: false,
                        borderColor: '#0d6efd',
                        backgroundColor: '#0d6efd',
                        tension: 0.3, // L√†m cong ƒë∆∞·ªùng
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#0d6efd',
                        pointHoverRadius: 6,
                        pointRadius: 5,
                        pointHoverBackgroundColor: '#0d6efd',
                        pointHoverBorderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            enabled: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'S·ªë h·ªçc vi√™n'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Kh√≥a h·ªçc'
                            }
                        }
                    }
                }
            });
            /*]]>*/
        </script>

            <script th:inline="javascript">
            /*<![CDATA[*/
            const roleLabels = /*[[${roleLabels}]]*/ ["H·ªçc vi√™n", "Gi·∫£ng vi√™n"];
            const roleCounts = /*[[${roleCounts}]]*/ [100, 20];

            const ctxPie = document.getElementById('pieChart').getContext('2d');
            new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: roleLabels,
                    datasets: [{
                        data: roleCounts,
                        backgroundColor: [
                            '#4e73df',
                            '#1cc88a'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            enabled: true
                        }
                    }
                }
            });
            /*]]>*/
        </script>

            <script th:inline="javascript">
            /*<![CDATA[*/
            const doanhThuLabels = /*[[${doanhThuLabels}]]*/ ["Th√°ng 3", "Th√°ng 4", "Th√°ng 5", "Th√°ng 6", "Th√°ng 7", "Th√°ng 8"];
            const doanhThuData = /*[[${doanhThuData}]]*/ [15000000, 18000000, 21000000, 16500000, 19500000, 23000000];

            const ctxDoanhThu = document.getElementById('doanhThuChart').getContext('2d');
            new Chart(ctxDoanhThu, {
                type: 'bar',
                data: {
                    labels: doanhThuLabels,
                    datasets: [{
                        label: 'T·ªïng doanh thu (VNƒê)',
                        data: doanhThuData,
                        backgroundColor: '#f6c23e',
                        borderRadius: 8,
                        barThickness: 40
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return new Intl.NumberFormat('vi-VN', {
                                        style: 'currency',
                                        currency: 'VND'
                                    }).format(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('vi-VN') + ' ƒë';
                                }
                            },
                            title: {
                                display: true,
                                text: 'VNƒê'
                            }
                        },
                        x: {
                            title: {
                                display: false
                            }
                        }
                    }
                }
            });
            /*]]>*/
        </script>

            <script th:inline="javascript">
            const labels = /*[[${labelsDanhMuc}]]*/ ["L·∫≠p tr√¨nh", "Marketing", "Thi·∫øt k·∫ø"];
            const data = /*[[${values}]]*/ [12, 9, 7];

            const ctxDanhMuc = document.getElementById('danhMucChart').getContext('2d');
            const myChart = new Chart(ctxDanhMuc, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'S·ªë kh√≥a h·ªçc ƒë√£ xu·∫•t b·∫£n',
                        data: data,
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // bi·ªÉu ƒë·ªì thanh ngang
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        </script>
        </main>
    </body>

</html>