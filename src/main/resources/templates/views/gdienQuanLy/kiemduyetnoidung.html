<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
    th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

    <head>
        <meta charset="UTF-8" />
        <title>Thông tin chi tiết về khóa học</title>
    </head>

    <body>
        <main class="khoahocchitiet">
            <div th:if="${khoaHoc != null}">
                <header class="course-header">
                    <div class="container">
                        <p class="lead" th:if="${khoaHoc.danhMuc}"
                            th:text="${khoaHoc.danhMuc.tenDanhMuc}">
                            Danh mục
                        </p>

                        <h1 th:text="${khoaHoc.tenKhoaHoc}">Tên khóa học</h1>

                        <!-- Giảng viên và số lượng đăng ký -->
                        <div
                            class="d-flex flex-wrap align-items-center gap-4 mt-2">
                            <p class="mb-0">
                                <i class="fas fa-chalkboard-teacher me-1"></i>
                                Giảng viên:
                                <a href="#" class="instructor-link"
                                    th:text="${khoaHoc.giangVien?.taikhoan?.name ?: 'Đang cập nhật'}">Tên
                                    Giảng Viên</a>
                            </p>
                        </div>

                        <div
                            class="d-flex flex-wrap align-items-center gap-4 mt-2">
                            <p class="text-muted fst-italic mt-2">
                                <i class="far fa-clock me-1"></i> Ngày tạo khóa
                                học:
                                <span
                                    th:text="${#temporals.format(khoaHoc.ngayTao, 'dd/MM/yyyy')}">
                                    01/01/2025
                                </span>
                            </p>

                            <!-- Cập nhật lần cuối -->
                            <p class="text-muted fst-italic mt-2">
                                <i class="far fa-clock me-1"></i> Ngày gửi yêu
                                cầu:
                                <span
                                    th:text="${#temporals.format(khoaHoc.ngayCapNhat, 'dd/MM/yyyy')}">
                                    01/01/2025
                                </span>
                            </p>
                        </div>
                    </div>
                </header>

                <div class="container my-4">
                    <div class="row">
                        <div class="col-lg-8">

                            <!-- Mô tả khóa học -->
                            <div
                                class="card shadow-sm rounded-4 mb-4 border-0 bg-light">
                                <div class="card-body">
                                    <h4 class="card-title text-primary mb-3">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Mô tả khóa học
                                    </h4>
                                    <p class="text-dark fs-6"
                                        th:text="${khoaHoc.moTa}">
                                        Mô tả chi tiết khóa học.
                                    </p>
                                </div>
                            </div>

                            <!-- Nội dung khóa học -->
                            <div class="card shadow-sm rounded-4 mb-4 border-0">
                                <div class="card-body" id="chuong-list">
                                    <h4 class="card-title text-success mb-3">
                                        <i class="fas fa-book-reader me-2"></i>
                                        Nội dung khóa học
                                    </h4>

                                    <div th:if="${#lists.isEmpty(chuongs)}">
                                        <p class="text-muted fst-italic">Chưa có
                                            chương nào cho khóa học này.</p>
                                    </div>

                                    <div th:if="${!#lists.isEmpty(chuongs)}"
                                        class="accordion" id="accordionChuong">
                                        <div class="accordion-item mb-2"
                                            th:each="chuong, iterStat : ${chuongs}">
                                            <h2 class="accordion-header"
                                                th:attr="id='heading' + ${iterStat.index}">
                                                <button
                                                    class="accordion-button collapsed bg-light"
                                                    type="button"
                                                    data-bs-toggle="collapse"
                                                    th:attr="data-bs-target='#collapse' + ${iterStat.index}"
                                                    aria-expanded="false"
                                                    th:attrappend="aria-controls='collapse' + ${iterStat.index}">
                                                    <strong
                                                        th:text="${chuong.tenchuong}">Tên
                                                        chương</strong>
                                                </button>
                                            </h2>
                                            <div
                                                th:attr="id='collapse' + ${iterStat.index}"
                                                class="accordion-collapse collapse"
                                                th:attrappend="aria-labelledby='heading' + ${iterStat.index}"
                                                data-bs-parent="#accordionChuong">
                                                <div class="accordion-body">

                                                    <!-- Có bài giảng -->
                                                    <ul
                                                        class="list-group list-group-flush mb-0"
                                                        th:if="${chuong.baiGiangs != null && !#lists.isEmpty(chuong.baiGiangs)}">
                                                        <li
                                                            class="list-group-item ps-4"
                                                            th:each="baiGiang : ${chuong.baiGiangs}">
                                                            <i
                                                                class="fas fa-book-open text-primary me-2"></i>
                                                            <span
                                                                th:text="${baiGiang.tenBaiGiang}">Tên
                                                                bài
                                                                giảng</span>
                                                        </li>
                                                    </ul>

                                                    <!-- Không có bài giảng -->
                                                    <p
                                                        th:if="${chuong.baiGiangs == null || #lists.isEmpty(chuong.baiGiangs)}"
                                                        class="text-muted fst-italic mt-2 ps-2">
                                                        <i
                                                            class="fas fa-exclamation-circle me-1"></i>
                                                        Chưa có bài giảng nào
                                                        trong chương này.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div
                                class="card shadow-sm rounded-4 overflow-hidden border-0">

                                <!-- Video + overlay "Xem trước" -->
                                <div class="position-relative">
                                    <div class="ratio ratio-16x9"
                                        th:if="${khoaHoc.urlGioiThieu != null}">
                                        <iframe th:src="${khoaHoc.urlGioiThieu}"
                                            class="rounded-0"
                                            title="Video giới thiệu khóa học"
                                            allowfullscreen></iframe>
                                    </div>
                                    <div th:if="${khoaHoc.urlGioiThieu == null}"
                                        class="text-muted p-3">
                                        Chưa có video giới thiệu.
                                    </div>

                                    <button
                                        class="btn btn-dark bg-opacity-50 text-white position-absolute top-50 start-50 translate-middle px-3 py-1 rounded border-0"
                                        data-bs-toggle="modal"
                                        data-bs-target="#videoModal">
                                        <i class="fas fa-play-circle me-1"></i>
                                        Xem trước
                                    </button>

                                </div>

                                <div class="card-body">

                                    <!-- Giá -->
                                    <div
                                        class="d-flex align-items-center mb-2 gap-1"
                                        th:if="${khoaHoc.giaKhuyenMai != null and khoaHoc.giaKhuyenMai.doubleValue() > 0}">
                                        <i
                                            class="fas fa-money-bill-wave text-success fs-6"></i>
                                        <span
                                            class="fw-semibold text-black fs-6">Đơn
                                            giá:</span>

                                        <span
                                            class="fw-semibold text-black fs-6 me-2"
                                            th:text="${#numbers.formatDecimal(khoaHoc.giaKhuyenMai, 0, 'COMMA', 0, 'POINT') + ' ₫'}">
                                        </span>

                                        <span
                                            class="text-muted text-decoration-line-through fs-6"
                                            th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT') + ' ₫'}">
                                        </span>
                                    </div>

                                    <div
                                        class="mb-3 d-flex align-items-center gap-1"
                                        th:if="${khoaHoc.giaKhuyenMai == null or khoaHoc.giaKhuyenMai.doubleValue() == 0}">
                                        <i
                                            class="fas fa-money-bill-wave text-success fs-6"></i>
                                        <span
                                            class="text-black fw-semibold fs-6">Đơn
                                            giá:</span>
                                        <span
                                            class="text-black fw-semibold fs-6"
                                            th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                                    </div>

                                </div>

                                <!-- Modal Video -->
                                <div class="modal fade" id="videoModal"
                                    tabindex="-1"
                                    aria-labelledby="videoModalLabel"
                                    aria-hidden="true">
                                    <div
                                        class="modal-dialog modal-dialog-centered modal-md">
                                        <div class="modal-content">
                                            <div class="modal-header border-0">
                                                <div>
                                                    <h5
                                                        class="modal-title fw-bold mb-1"
                                                        id="videoModalLabel">Xem
                                                        trước khóa học</h5>
                                                    <p class="text-muted mb-0"
                                                        th:text="${khoaHoc.tenKhoaHoc}">Tên
                                                        khóa học</p>
                                                </div>
                                                <button type="button"
                                                    class="btn-close"
                                                    data-bs-dismiss="modal"
                                                    aria-label="Đóng"></button>
                                            </div>

                                            <div class="modal-body p-0">
                                                <div class="ratio ratio-16x9">
                                                    <iframe id="modalVideo"
                                                        th:src="${khoaHoc.urlGioiThieu}"
                                                        title="Video giới thiệu"
                                                        allowfullscreen></iframe>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="alert alert-info d-flex align-items-start gap-2 small mt-3"
                                role="alert">
                                <i class="fas fa-eye text-primary mt-1"></i>
                                <div>
                                    <strong>Hãy xem nội dung chi tiết của khóa
                                        học trước khi kiểm duyệt.</strong><br />
                                    Vui lòng kiểm tra các chương và bài giảng
                                    của khóa học.
                                </div>
                            </div>

                            <div class="d-flex gap-2">
                                <div class="d-flex gap-2" th:if="${coNoiDung}">
                                    <a
                                        th:href="@{/kiem-duyet-khoa-hoc/khoahoc/slug/{slug}(slug=${khoaHoc.slug})}"
                                        class="btn btn-outline-primary">
                                        <i class="fas fa-list-alt"></i> Xem chi
                                        tiết nội dung khóa học
                                    </a>
                                </div>
                            </div>

                            <div class="mt-4">
                                <div
                                    class="p-3 bg-light rounded-4 shadow-sm border border-1">
                                    <p class="mb-3 text-muted fw-semibold">
                                        <i
                                            class="fas fa-info-circle me-2 text-primary"></i>
                                        Quay lại danh sách khóa học
                                    </p>
                                    <a href="javascript:history.back()"
                                        class="btn btn-outline-dark rounded-pill shadow d-inline-flex align-items-center gap-2 px-4 py-2">
                                        <i
                                            class="fas fa-arrow-left fa-lg text-secondary"></i>
                                        <span class="fw-semibold">Quay
                                            lại</span>
                                    </a>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>

            <script>
            const videoModal = document.getElementById('videoModal');
            const iframe = document.getElementById('modalVideo');
            const originalSrc = iframe.src;

            videoModal.addEventListener('hidden.bs.modal', function() {
                iframe.src = '';
                setTimeout(() => {
                    iframe.src = originalSrc;
                }, 100);
            });
        </script>
        </main>
    </body>

</html>