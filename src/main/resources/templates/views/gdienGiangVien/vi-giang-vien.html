<!DOCTYPE html>
<html lang="vi"
    th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

    <head>
        <meta charset="UTF-8">
        <title>V√≠ Gi·∫£ng Vi√™n</title>
    </head>

    <body>
        <main class="vigiangvien">
            <div id="toastContainer" class="position-fixed top-0 end-0 p-3"
                style="z-index: 1055;"></div>

            <div class="container mt-4">
                <h2 class="vigiangvien-heading">
                    <i class="fas fa-wallet me-2 vigiangvien-icon-vang"></i> V√≠
                    Gi·∫£ng Vi√™n
                </h2>

                <!-- Th√¥ng b√°o -->
                <div th:if="${param.success}"
                    class="alert alert-success mt-3">Y√™u c·∫ßu r√∫t ti·ªÅn ƒë√£ g·ª≠i
                    th√†nh c√¥ng!</div>
                <div th:if="${param.error}" class="alert alert-danger mt-3">S·ªë
                    ti·ªÅn r√∫t kh√¥ng h·ª£p l·ªá ho·∫∑c v∆∞·ª£t qu√° s·ªë d∆∞!</div>

                <div class="row mb-3">
                    <!-- S·ªë d∆∞ hi·ªán t·∫°i -->
                    <div class="col-md-4">
                        <div
                            class="card shadow-sm border-0 h-100 rounded-4 bg-light-subtle">
                            <div class="card-body text-center mt-3">
                                <h6 class="text-muted">
                                    <i
                                        class="bi bi-wallet2 text-primary me-2"></i>
                                    S·ªë D∆∞ Hi·ªán T·∫°i
                                </h6>
                                <h4 class="text-success fw-bold mb-5">
                                    <i class="bi bi-cash-stack me-2"></i>
                                    <span
                                        th:text="${#numbers.formatDecimal(soDu, 0, 'COMMA', 0, 'POINT')}"></span>
                                    VNƒê
                                </h4>

                                <!-- B·ªë c·ª•c hi·ªÉn th·ªã doanh thu v√† s·ªë l·∫ßn nh·∫≠n -->
                                <div
                                    class="d-flex justify-content-between mt-5">
                                    <div
                                        class="d-flex flex-column align-items-center">
                                        <i
                                            class="bi bi-cash-coin fs-4 text-success"></i>
                                        <small class="text-muted mt-1">Doanh thu
                                            th√°ng n√†y</small>
                                        <span class="fw-bold text-dark"
                                            th:text="${#numbers.formatDecimal(tongThuThang, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></span>
                                    </div>
                                    <div
                                        class="d-flex flex-column align-items-center">
                                        <i
                                            class="bi bi-hand-index-thumb fs-4 text-primary"></i>
                                        <small class="text-muted mt-1">S·ªë l·∫ßn
                                            nh·∫≠n</small>
                                        <span id="so-lan-nhan"
                                            class="fw-bold text-dark"
                                            th:text="${soLanNhanThang} + ' l∆∞·ª£t'"
                                            onclick="moModalLichSuNhanTien()"
                                            style="cursor: pointer;"></span>
                                    </div>
                                </div>

                                <button type="button"
                                    class="btn btn-outline-success btn-sm mt-5"
                                    onclick="moTabRutTien()">R√∫t ti·ªÅn</button>
                            </div>
                        </div>

                    </div>

                    <!-- L·ªãch s·ª≠ nh·∫≠n ti·ªÅn -->
                    <div class="col-md-8">
                        <div class="card h-100">
                            <div class="card-header"> <i
                                    class="fas fa-money-bill-wave me-2"></i>L·ªãch
                                S·ª≠ Nh·∫≠n Ti·ªÅn</div>
                            <div class="card-body d-flex flex-column"
                                style="min-height: 350px;">
                                <div class="flex-grow-1">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>M√£</th>
                                                <th>S·ªë ti·ªÅn</th>
                                                <th>Ng√†y</th>
                                                <th>Kh√≥a h·ªçc</th>
                                            </tr>
                                        </thead>
                                        <tbody id="lich-su-nhan-tien-body">
                                            <tr
                                                th:each="item : ${lichSuThuNhap}">
                                                <td
                                                    th:text="${item.doanhthuId}"></td>
                                                <td
                                                    th:text="${#numbers.formatDecimal(item.sotiennhan, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
                                                <td
                                                    th:text="${#temporals.format(item.ngaynhan, 'dd-MM-yyyy HH:mm')}"></td>
                                                <td
                                                    th:text="${item.dangHoc != null and item.dangHoc.khoahoc != null ? item.dangHoc.khoahoc.tenKhoaHoc : 'Kh√¥ng r√µ'}"></td>
                                            </tr>
                                            <tr
                                                th:if="${lichSuThuNhap.isEmpty()}">
                                                <td colspan="4"
                                                    class="text-center">Kh√¥ng c√≥
                                                    d·ªØ li·ªáu
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div id="pagination"
                                    class="mt-3 d-flex justify-content-center flex-wrap gap-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="card mb-3">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="viTabs"
                            role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="yeu-cau-tab"
                                    data-bs-toggle="tab"
                                    data-bs-target="#yeu-cau" type="button"
                                    role="tab" aria-controls="yeu-cau"
                                    aria-selected="true"> <i
                                        class="fas fa-hand-holding-usd me-2"></i>
                                    Y√™u c·∫ßu r√∫t
                                    ti·ªÅn</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="lich-su-tab"
                                    data-bs-toggle="tab"
                                    data-bs-target="#lich-su" type="button"
                                    role="tab" aria-controls="lich-su"
                                    aria-selected="false"><i
                                        class="fas fa-clock me-2"></i>L·ªãch s·ª≠
                                    r√∫t
                                    ti·ªÅn</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="dang-cho-tab"
                                    data-bs-toggle="tab"
                                    data-bs-target="#dang-cho" type="button"
                                    role="tab" aria-controls="dang-cho"
                                    aria-selected="false"> <i
                                        class="fas fa-hourglass-half me-2"></i>
                                    Y√™u c·∫ßu ƒëang ch·ªù x·ª≠
                                    l√Ω</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body tab-content" id="viTabsContent">
                        <!-- Tab 1: Y√™u c·∫ßu r√∫t ti·ªÅn -->
                        <div class="tab-pane fade show active" id="yeu-cau"
                            role="tabpanel" aria-labelledby="yeu-cau-tab">
                            <form id="formRutTien" onsubmit="return false;">
                                <div class="mb-3">
                                    <label class="form-label">S·ªë ti·ªÅn mu·ªën r√∫t
                                        (t·ªëi thi·ªÉu 100.000 VNƒê)</label>
                                    <input type="number" name="soTienRut"
                                        class="form-control" min="100000"
                                        required>
                                </div>
                                <button type="button" class="btn btn-success"
                                    onclick="handleRutTien()">G·ª≠i y√™u
                                    c·∫ßu</button>
                            </form>
                        </div>

                        <!-- Tab 2: L·ªãch s·ª≠ r√∫t ti·ªÅn -->
                        <div class="tab-pane fade" id="lich-su" role="tabpanel"
                            aria-labelledby="lich-su-tab">
                            <table class="table mt-3">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-hashtag me-2"></i>
                                            M√£
                                        </th>
                                        <th><i
                                                class="fas fa-dollar-sign me-2"></i>
                                            S·ªë ti·ªÅn</th>
                                        <th><i
                                                class="fas fa-calendar-alt me-2"></i>
                                            Ng√†y
                                        </th>
                                        <th><i
                                                class="fas fa-info-circle me-2"></i>
                                            Tr·∫°ng th√°i</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="item : ${lichSuRutTien}">
                                        <td th:text="${item.rutTienId}"></td>
                                        <td
                                            th:text="${#numbers.formatDecimal(item.soTienRut, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
                                        <td
                                            th:text="${#temporals.format(item.ngayrut, 'dd-MM-yyyy HH:mm')}"></td>
                                        <td
                                            th:switch="${item.trangthai.name()}">
                                            <span th:case="'DANG_CHO_XU_LY'"
                                                class="text-warning">ƒêang ch·ªù x·ª≠
                                                l√Ω</span>
                                            <span th:case="'THANH_CONG'"
                                                class="text-success">Th√†nh
                                                c√¥ng</span>
                                            <span th:case="'TU_CHOI'"
                                                class="text-danger">T·ª´
                                                ch·ªëi</span>
                                            <span th:case="*">Kh√¥ng x√°c
                                                ƒë·ªãnh</span>
                                        </td>
                                    </tr>
                                    <tr th:if="${lichSuRutTien.isEmpty()}">
                                        <td colspan="4"
                                            class="text-center">Kh√¥ng c√≥ d·ªØ li·ªáu
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Tab 3: Y√™u c·∫ßu ƒëang ch·ªù x·ª≠ l√Ω -->
                        <div class="tab-pane fade" id="dang-cho" role="tabpanel"
                            aria-labelledby="dang-cho-tab">
                            <table class="table mt-3">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-hashtag me-2"></i>
                                            M√£
                                        </th>
                                        <th><i
                                                class="fas fa-dollar-sign me-2"></i>
                                            S·ªë ti·ªÅn</th>
                                        <th><i
                                                class="fas fa-calendar-alt me-2"></i>
                                            Ng√†y
                                        </th>
                                        <th><i
                                                class="fas fa-info-circle me-2"></i>
                                            Tr·∫°ng th√°i</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="item : ${yeuCauDangXuLy}">
                                        <td th:text="${item.rutTienId}"></td>
                                        <td
                                            th:text="${#numbers.formatDecimal(item.soTienRut, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
                                        <td
                                            th:text="${#temporals.format(item.ngayrut, 'dd-MM-yyyy HH:mm')}"></td>
                                        <td
                                            th:switch="${item.trangthai.name()}">
                                            <span th:case="'DANG_CHO_XU_LY'"
                                                class="text-warning">ƒêang ch·ªù x·ª≠
                                                l√Ω</span>
                                            <span th:case="'THANH_CONG'"
                                                class="text-success">Th√†nh
                                                c√¥ng</span>
                                            <span th:case="'TU_CHOI'"
                                                class="text-danger">T·ª´
                                                ch·ªëi</span>
                                            <span th:case="*">Kh√¥ng x√°c
                                                ƒë·ªãnh</span>
                                        </td>
                                    </tr>
                                    <tr th:if="${yeuCauDangXuLy.isEmpty()}">
                                        <td colspan="4"
                                            class="text-center">Kh√¥ng c√≥ y√™u c·∫ßu
                                            n√†o ƒëang x·ª≠ l√Ω</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Modal Nh·∫≠p Th√¥ng Tin Ng√¢n H√†ng -->
                <div class="modal fade" id="modalSTK" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Nh·∫≠p th√¥ng tin ng√¢n h√†ng
                                </h5>
                            </div>
                            <div class="modal-body">
                                <input id="soTaiKhoan" type="text"
                                    class="form-control mb-2"
                                    placeholder="S·ªë t√†i kho·∫£n" required>
                                <input list="dsNganHang" id="tenNganHang"
                                    class="form-control mb-2"
                                    placeholder="Nh·∫≠p ho·∫∑c ch·ªçn ng√¢n h√†ng"
                                    required>
                                <datalist id="dsNganHang">
                                    <option
                                        value="Vietcombank (Ng√¢n h√†ng TMCP Ngo·∫°i th∆∞∆°ng Vi·ªát Nam)">
                                        <option
                                            value="VietinBank (Ng√¢n h√†ng TMCP C√¥ng Th∆∞∆°ng Vi·ªát Nam)">
                                            <option
                                                value="BIDV (Ng√¢n h√†ng TMCP ƒê·∫ßu t∆∞ v√† Ph√°t tri·ªÉn Vi·ªát Nam)">
                                                <option
                                                    value="Agribank (Ng√¢n h√†ng N√¥ng nghi·ªáp v√† Ph√°t tri·ªÉn N√¥ng th√¥n)">
                                                    <option
                                                        value="Techcombank (Ng√¢n h√†ng TMCP K·ªπ Th∆∞∆°ng Vi·ªát Nam)">
                                                        <option
                                                            value="ACB (Ng√¢n h√†ng TMCP √Å Ch√¢u)">
                                                        </datalist>

                                                        <!-- ‚úÖ N√∫t ƒë·ªïi ng√¢n h√†ng N·∫∞M NGO√ÄI datalist -->
                                                        <div
                                                            class="text-end mt-1">
                                                            <button
                                                                type="button"
                                                                class="btn btn-link p-0 mt-2"
                                                                onclick="moModalDoiSTK()">ƒê·ªïi
                                                                t√†i kho·∫£n ng√¢n
                                                                h√†ng</button>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button"
                                                            class="btn btn-primary"
                                                            onclick="submitThongTinNganHang()">L∆∞u</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Modal ƒê·ªïi STK -->
                                        <div class="modal fade" id="modalDoiSTK"
                                            tabindex="-1">
                                            <div
                                                class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5
                                                            class="modal-title">ƒê·ªïi
                                                            t√†i kho·∫£n ng√¢n h√†ng
                                                        </h5>
                                                    </div>
                                                    <div class="modal-body">
                                                        <input
                                                            id="doi_soTaiKhoan"
                                                            type="text"
                                                            class="form-control mb-2"
                                                            placeholder="S·ªë t√†i kho·∫£n m·ªõi"
                                                            required>
                                                        <input list="dsNganHang"
                                                            id="doi_tenNganHang"
                                                            class="form-control mb-2"
                                                            placeholder="Nh·∫≠p ho·∫∑c ch·ªçn ng√¢n h√†ng m·ªõi"
                                                            required>
                                                        <datalist
                                                            id="dsNganHang">
                                                            <option
                                                                value="Vietcombank (Ng√¢n h√†ng TMCP Ngo·∫°i th∆∞∆°ng Vi·ªát Nam)">
                                                                <option
                                                                    value="VietinBank (Ng√¢n h√†ng TMCP C√¥ng Th∆∞∆°ng Vi·ªát Nam)">
                                                                    <option
                                                                        value="BIDV (Ng√¢n h√†ng TMCP ƒê·∫ßu t∆∞ v√† Ph√°t tri·ªÉn Vi·ªát Nam)">
                                                                        <option
                                                                            value="Agribank (Ng√¢n h√†ng N√¥ng nghi·ªáp v√† Ph√°t tri·ªÉn N√¥ng th√¥n)">
                                                                            <option
                                                                                value="Techcombank (Ng√¢n h√†ng TMCP K·ªπ Th∆∞∆°ng Vi·ªát Nam)">
                                                                                <option
                                                                                    value="ACB (Ng√¢n h√†ng TMCP √Å Ch√¢u)">
                                                                                </datalist>
                                                                            </div>
                                                                            <div
                                                                                class="modal-footer">
                                                                                <button
                                                                                    type="button"
                                                                                    class="btn btn-primary"
                                                                                    onclick="xacNhanDoiSTK()">X√°c
                                                                                    nh·∫≠n</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <!-- Modal Nh·∫≠p OTP -->
                                                                <div
                                                                    class="modal fade"
                                                                    id="modalOTP"
                                                                    tabindex="-1">
                                                                    <div
                                                                        class="modal-dialog modal-dialog-centered">
                                                                        <div
                                                                            class="modal-content">
                                                                            <div
                                                                                class="modal-header">
                                                                                <h5
                                                                                    class="modal-title">X√°c
                                                                                    th·ª±c
                                                                                    OTP
                                                                                </h5>
                                                                            </div>
                                                                            <div
                                                                                class="modal-body">
                                                                                <input
                                                                                    id="otp"
                                                                                    type="text"
                                                                                    class="form-control mb-2"
                                                                                    placeholder="Nh·∫≠p m√£ OTP v·ª´a nh·∫≠n qua email">

                                                                                <!-- üîí Th√™m c·∫£nh b√°o n·ªïi b·∫≠t -->
                                                                                <div
                                                                                    class="otp-alert mt-3">
                                                                                    <span
                                                                                        class="otp-icon">üîí</span>
                                                                                    <span
                                                                                        class="otp-text">M√£
                                                                                        OTP
                                                                                        ch·ªâ
                                                                                        ƒë∆∞·ª£c
                                                                                        s·ª≠
                                                                                        d·ª•ng
                                                                                        <b>m·ªôt
                                                                                            l·∫ßn
                                                                                            duy
                                                                                            nh·∫•t</b>.
                                                                                        Kh√¥ng
                                                                                        chia
                                                                                        s·∫ª
                                                                                        v·ªõi
                                                                                        b·∫•t
                                                                                        k·ª≥
                                                                                        ai.</span>
                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                class="modal-footer">
                                                                                <button
                                                                                    type="button"
                                                                                    class="btn btn-primary"
                                                                                    onclick="submitOTP()">X√°c
                                                                                    nh·∫≠n</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <script
                                                                th:inline="javascript">
            const giangVienId = /*[[${giangvienId}]]*/ 0;
            let soTaiKhoan = '';
            let tenNganHang = '';
            let isFirstTime = true;
            let isChangingBankInfo = false; // ‚úÖ TH√äM BI·∫æN N√ÄY

            $(document).ready(function() {
                fetch('/giangvien/vi-giang-vien/thong-tin-ngan-hang')
                    .then(res => res.json())
                    .then(data => {
                        if (data && data.soTaiKhoan && data.tenNganHang) {
                            isFirstTime = false;
                            soTaiKhoan = data.soTaiKhoan;
                            tenNganHang = data.tenNganHang;

                            $('#soTaiKhoan').val(soTaiKhoan).prop('readonly', true);
                            $('#tenNganHang').val(tenNganHang).prop('readonly', true);
                        } else {
                            isFirstTime = true;
                            $('#soTaiKhoan').val('').prop('readonly', false);
                            $('#tenNganHang').val('').prop('readonly', false);
                        }
                    });

                $('#modalOTP').on('show.bs.modal', function() {
                    $('#otp').val('');
                });
            });

            // ‚úÖ M·ªû FORM R√öT TI·ªÄN
            function handleRutTien() {
                const soTienRut = $("input[name='soTienRut']").val();
                if (!soTienRut || soTienRut < 100000) {
                    showToast('S·ªë ti·ªÅn r√∫t t·ªëi thi·ªÉu l√† 100.000 VNƒê', false);
                    return;
                }

                isChangingBankInfo = false; // kh√¥ng ph·∫£i ƒëang ƒë·ªïi STK
                $('#modalSTK').modal('show');
            }

            // ‚úÖ L∆ØU STK v√† G·ª¨I OTP T√ôY THEO TR·∫†NG TH√ÅI
            function submitThongTinNganHang() {
                soTaiKhoan = $('#soTaiKhoan').val();
                tenNganHang = $('#tenNganHang').val();
                if (!soTaiKhoan || !tenNganHang) {
                    showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß s·ªë t√†i kho·∫£n v√† t√™n ng√¢n h√†ng!', false);
                    return;
                }

                $('#modalSTK').modal('hide');
                $('#modalOTP').modal('show');

                const url = isChangingBankInfo ?
                    '/giangvien/vi-giang-vien/gui-otp-doi-stk' // n·∫øu ƒë·ªïi STK ‚Üí g·ª≠i OTP ri√™ng n·∫øu c·∫ßn
                    :
                    '/giangvien/vi-giang-vien/gui-otp';

                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        soTaiKhoan,
                        tenNganHang
                    })
                }).then(res => {
                    if (!res.ok) {
                        showToast('Kh√¥ng g·ª≠i ƒë∆∞·ª£c m√£ x√°c th·ª±c! Vui l√≤ng th·ª≠ l·∫°i.', false);
                        $('#modalOTP').modal('hide');
                    }
                });
            }

            // ‚úÖ X√ÅC NH·∫¨N OTP
            function submitOTP() {
                const otp = $('#otp').val();
                const soTienRut = $("input[name='soTienRut']").val();

                if (!otp) {
                    showToast('Vui l√≤ng nh·∫≠p m√£ x√°c th·ª±c!', false);
                    return;
                }

                if (isChangingBankInfo) {
                    fetch('/giangvien/vi-giang-vien/cap-nhat-ngan-hang', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: new URLSearchParams({
                            giangVienId,
                            soTaiKhoan,
                            tenNganHang,
                            otp
                        })
                    }).then(res => {
                        $('#modalOTP').modal('hide');
                        if (res.ok) {
                            showToast('C·∫≠p nh·∫≠t t√†i kho·∫£n ng√¢n h√†ng th√†nh c√¥ng!', true);
                            $('#soTaiKhoan').val(soTaiKhoan).prop('readonly', true);
                            $('#tenNganHang').val(tenNganHang).prop('readonly', true);
                            isChangingBankInfo = false;
                        } else {
                            showToast('C·∫≠p nh·∫≠t th·∫•t b·∫°i!', false);
                        }
                    });
                } else {
                    fetch('/giangvien/vi-giang-vien/xac-thuc-otp', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: new URLSearchParams({
                            soTaiKhoan,
                            tenNganHang,
                            soTienRut,
                            otp
                        })
                    }).then(async res => {
                        $('#modalOTP').modal('hide');
                        if (res.ok) {
                            showToast('‚úÖ Y√™u c·∫ßu r√∫t ti·ªÅn ƒë√£ x√°c th·ª±c! H·ªá th·ªëng s·∫Ω x·ª≠ l√Ω trong v√≤ng 24h.', true);

                            // ‚úÖ X√≥a input r√∫t ti·ªÅn cho s·∫°ch form l·∫°i
                            $("input[name='soTienRut']").val('');
                        } else {
                            const msg = await res.text();
                            showToast(msg || 'M√£ x√°c th·ª±c kh√¥ng ƒë√∫ng ho·∫∑c ƒë√£ h·∫øt h·∫°n!', false);
                        }
                    });
                }
            }


            // ‚úÖ CHO PH√âP ƒê·ªîI TH√îNG TIN STK
            function choPhepDoiThongTin() {
                isChangingBankInfo = true;
                $('#soTaiKhoan').prop('readonly', false).val('').focus();
                $('#tenNganHang').prop('readonly', false).val('');
            }


            // M·ªü modal ƒë·ªïi t√†i kho·∫£n
            function moModalDoiSTK() {
                $('#modalDoiSTK').modal('show');
            }

            // Khi b·∫•m x√°c nh·∫≠n ƒë·ªïi STK ‚Üí g·ª≠i OTP ƒë·ªïi STK
            function xacNhanDoiSTK() {
                const stkMoi = $('#doi_soTaiKhoan').val();
                const bankMoi = $('#doi_tenNganHang').val();

                if (!stkMoi || !bankMoi) {
                    showToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', false);
                    return;
                }

                isChangingBankInfo = true;
                soTaiKhoan = stkMoi;
                tenNganHang = bankMoi;

                $('#modalDoiSTK').modal('hide');
                $('#modalOTP').modal('show');

                fetch('/giangvien/vi-giang-vien/gui-otp-doi-stk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        soTaiKhoan,
                        tenNganHang
                    })
                }).then(res => {
                    if (!res.ok) {
                        showToast('Kh√¥ng g·ª≠i ƒë∆∞·ª£c m√£ x√°c th·ª±c!', false);
                        $('#modalOTP').modal('hide');
                    }
                });
            }

            function showToast(message, isSuccess = true) {
                const toastId = `toast-${Date.now()}`;
                const toastHtml = `
                <div id="${toastId}" class="toast align-items-center text-white ${isSuccess ? 'bg-success' : 'bg-danger'} border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                </div>`;
                $('#toastContainer').append(toastHtml);

                // T·ª± ƒë√≥ng sau 5s
                setTimeout(() => {
                    $(`#${toastId}`).remove();
                }, 5000);
            }
        </script>

                                                            <script>
            document.addEventListener("DOMContentLoaded", function() {
                const rowsPerPage = 5;
                const tbody = document.getElementById("lich-su-nhan-tien-body");
                const rows = Array.from(tbody.querySelectorAll("tr"));
                const pagination = document.getElementById("pagination");

                function showPage(page) {
                    const start = (page - 1) * rowsPerPage;
                    const end = start + rowsPerPage;

                    rows.forEach((row, index) => {
                        row.style.display = index >= start && index < end ? "" : "none";
                    });

                    renderPagination(page);
                }

                function renderPagination(currentPage) {
                    const totalPages = Math.ceil(rows.length / rowsPerPage);
                    pagination.innerHTML = '';

                    if (totalPages <= 1) return;

                    function createButton(page) {
                        const btn = document.createElement("button");
                        btn.className = `btn btn-sm ${page === currentPage ? 'btn-primary' : 'btn-outline-primary'}`;
                        btn.textContent = page;
                        btn.style.minWidth = "25px";
                        btn.style.padding = "2px 6px";
                        btn.style.fontSize = "12px";
                        btn.addEventListener("click", () => showPage(page));
                        pagination.appendChild(btn);
                    }

                    function createEllipsis() {
                        const span = document.createElement("span");
                        span.textContent = "...";
                        span.className = "mx-1";
                        pagination.appendChild(span);
                    }

                    // Lu√¥n hi·ªán trang 1
                    createButton(1);

                    // Hi·ªán d·∫•u ... n·∫øu currentPage > 4
                    if (currentPage > 4) {
                        createEllipsis();
                    }

                    // X√°c ƒë·ªãnh kho·∫£ng n√∫t ·ªü gi·ªØa
                    const startPage = Math.max(2, currentPage - 2);
                    const endPage = Math.min(totalPages - 1, currentPage + 2);

                    for (let i = startPage; i <= endPage; i++) {
                        createButton(i);
                    }

                    // Hi·ªán d·∫•u ... n·∫øu currentPage < totalPages -3
                    if (currentPage < totalPages - 3) {
                        createEllipsis();
                    }

                    // Lu√¥n hi·ªán trang cu·ªëi n·∫øu >1
                    if (totalPages > 1) {
                        createButton(totalPages);
                    }
                }

                if (rows.length > 0) {
                    showPage(1);
                }
            });
        </script>

                                                            <script>
            function moTabRutTien() {
                // K√≠ch ho·∫°t tab "Y√™u c·∫ßu r√∫t ti·ªÅn"
                const tabTrigger = document.querySelector('#yeu-cau-tab');
                const tab = new bootstrap.Tab(tabTrigger);
                tab.show();

                // Cu·ªôn xu·ªëng v·ªã tr√≠ tab
                document.getElementById("yeu-cau").scrollIntoView({
                    behavior: "smooth"
                });
            }
        </script>

                                                            <script>
            document.addEventListener("DOMContentLoaded", function() {
                document.querySelector(".vigiangvien").classList.add("loaded");
            });
        </script>
                                                        </main>
                                                    </body>

                                                </html>