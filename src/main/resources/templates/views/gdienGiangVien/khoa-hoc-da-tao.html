<!DOCTYPE html>
<html lang="vi"
    th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

    <head>
        <meta charset="UTF-8">
        <title>Khóa học đã tạo</title>
    </head>

    <body>
        <main class="khoahocdatao">
            <div class="container mt-4">
                <div
                    class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold underline-animated m-0">
                        <i class="fas fa-book-open me-2 text-icon-green"></i>
                        <span class="text-title-blue">Danh sách khóa học đã
                            tạo</span>
                    </h4>
                    <a href="/giangvien/them-moi-khoa-hoc"
                        class="btn text-primary mt-3 underline-animated">
                        ➕ Thêm khóa học mới
                    </a>
                </div>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" id="courseTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="pending-tab"
                            data-bs-toggle="tab" data-bs-target="#pending"
                            type="button" role="tab"> <i
                                class="fas fa-clock me-1 text-warning"></i>Chờ
                            duyệt</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="draft-tab"
                            data-bs-toggle="tab" data-bs-target="#draft"
                            type="button" role="tab"><i
                                class="fas fa-pen me-1 text-secondary"></i>Bản
                            nháp</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="published-tab"
                            data-bs-toggle="tab" data-bs-target="#published"
                            type="button" role="tab"><i
                                class="fas fa-check-circle me-1 text-success"></i>Đã
                            xuất bản</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="unpublished-tab"
                            data-bs-toggle="tab" data-bs-target="#unpublished"
                            type="button" role="tab"><i
                                class="fas fa-trash-alt me-1 text-danger"></i>Đã
                            xóa</button>
                    </li>
                </ul>

                <!-- Tab content -->
                <div class="tab-content mt-3">
                    <!-- Chờ duyệt -->
                    <div class="tab-pane fade show active" id="pending"
                        role="tabpanel">
                        <section class="mb-5 mt-3"
                            th:if="!${#lists.isEmpty(listPendingApproval)}">
                            <div
                                class="section-header mb-3 mt-4 px-3 py-2 border-start border-4 border-warning">
                                <h4 class="fw-bold text-dark m-0">
                                    <i
                                        class="bi bi-hourglass-split text-warning me-2"></i>
                                    Khóa học đang chờ duyệt
                                </h4>
                            </div>

                            <ul class="list-group shadow-sm">
                                <th:block
                                    th:each="khoaHoc : ${listPendingApproval}">
                                    <li
                                        class="list-group-item khoa-hoc-cho-duyet d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            <div class="fw-semibold">
                                                <i
                                                    class="bi bi-book text-primary me-1"></i>
                                                <span
                                                    class="text-primary fw-semibold me-1">Tên
                                                    khóa học:</span>
                                                <span
                                                    th:text="${khoaHoc.tenKhoaHoc}">Tên
                                                    khóa học</span>
                                            </div>

                                            <small class="text-muted">
                                                <i
                                                    class="bi bi-tag-fill me-1 text-secondary"></i>
                                                Mã: <span
                                                    th:text="${khoaHoc.khoahocId}"></span>
                                                |
                                                <i
                                                    class="bi bi-currency-dollar me-1 text-success"></i>
                                                Giá: <span
                                                    th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT')} + '₫'"></span>
                                            </small>
                                        </div>
                                        <div
                                            class="d-flex align-items-center gap-2">
                                            <button
                                                class="btn btn-outline-danger rounded-pill px-2 py-0"
                                                style="height: 28px; font-size: 0.8rem; line-height: 1"
                                                data-bs-toggle="modal"
                                                th:attr="data-bs-target='#modalHuyYeuCau-' + ${khoaHoc.khoahocId}">
                                                <i
                                                    class="bi bi-x-circle me-1"></i>Hủy
                                                yêu cầu
                                            </button>

                                            <span
                                                class="btn bg-warning text-dark rounded-pill d-flex align-items-center justify-content-center px-2 py-0"
                                                style="height: 28px; font-size: 0.8rem; line-height: 1">
                                                <i
                                                    class="bi bi-clock-history me-1"></i>Chờ
                                                duyệt
                                            </span>
                                        </div>
                                    </li>

                                    <!-- Modal xác nhận hủy yêu cầu -->
                                    <div class="modal fade"
                                        th:id="'modalHuyYeuCau-' + ${khoaHoc.khoahocId}"
                                        tabindex="-1">
                                        <div
                                            class="modal-dialog modal-dialog-centered">
                                            <div
                                                class="modal-content rounded-4 shadow-lg border-0">
                                                <div
                                                    class="modal-header bg-danger text-white rounded-top-4">
                                                    <h5 class="modal-title">
                                                        <i
                                                            class="bi bi-exclamation-triangle-fill me-2"></i>
                                                        Xác nhận hủy yêu cầu
                                                    </h5>
                                                    <button type="button"
                                                        class="btn-close btn-close-white"
                                                        data-bs-dismiss="modal"></button>
                                                </div>
                                                <div
                                                    class="modal-body text-center py-4">
                                                    <i
                                                        class="bi bi-x-circle-fill text-danger fs-2 mb-3"></i>
                                                    <p class="mb-0">
                                                        Bạn có chắc chắn muốn
                                                        <strong>hủy yêu cầu
                                                            duyệt</strong> khóa
                                                        học này không?<br> Khóa
                                                        học sẽ được
                                                        <strong>chuyển về bản
                                                            nháp</strong>.
                                                    </p>
                                                </div>
                                                <div
                                                    class="modal-footer justify-content-center bg-light rounded-bottom-4">
                                                    <button type="button"
                                                        class="btn btn-outline-secondary px-4"
                                                        data-bs-dismiss="modal">
                                                        Không
                                                    </button>
                                                    <form
                                                        th:action="@{/giangvien/huy-yeu-cau-khoa-hoc/{id}(id=${khoaHoc.khoahocId})}"
                                                        method="post">
                                                        <button type="submit"
                                                            class="btn btn-outline-danger px-4">
                                                            Đồng ý
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </th:block>
                            </ul>
                        </section>

                        <div th:if="${#lists.isEmpty(listPendingApproval)}"
                            class="text-muted">Bạn chưa có khóa học nào.</div>
                    </div>

                    <!-- Nháp -->
                    <div class="tab-pane fade" id="draft" role="tabpanel">
                        <section class="mb-5 mt-3"
                            th:if="!${#lists.isEmpty(listDraft)}">
                            <div
                                class="section-header mb-3 mt-4 px-3 py-2 border-start border-4 border-info">
                                <h4 class="fw-bold text-dark m-0">
                                    <i
                                        class="bi bi-pencil-square text-info me-2"></i>
                                    Khóa học bản nháp
                                </h4>
                            </div>

                            <ul class="list-group shadow-sm">
                                <th:block th:each="khoaHoc : ${listDraft}">
                                    <li
                                        class="list-group-item khoa-hoc-nhap d-flex justify-content-between align-items-start">
                                        <div class="ms-2 me-auto">
                                            <div class="fw-semibold">
                                                <i
                                                    class="bi bi-book text-primary me-1"></i>
                                                <span
                                                    class="text-primary fw-semibold me-1">Tên
                                                    khóa học:</span>
                                                <span
                                                    th:text="${khoaHoc.tenKhoaHoc}">Tên
                                                    khóa học</span>
                                            </div>

                                            <small class="text-muted">
                                                <i
                                                    class="bi bi-tag-fill me-1 text-secondary"></i>
                                                Mã: <span
                                                    th:text="${khoaHoc.khoahocId}"></span>
                                                |
                                                <i
                                                    class="bi bi-currency-dollar me-1 text-success"></i>
                                                Giá: <span
                                                    th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT')} + '₫'"></span>
                                            </small>
                                        </div>

                                        <div
                                            class="d-flex align-items-center gap-2">
                                            <a
                                                th:href="@{/giangvien/them-moi-khoa-hoc/them-chuong(khoahocId=${khoaHoc.khoahocId})}"
                                                class="btn btn-outline-primary rounded-pill px-2 py-0"
                                                style="height: 28px; font-size: 0.8rem;">
                                                <i
                                                    class="bi bi-pencil-square me-1"></i>Chỉnh
                                                sửa
                                            </a>

                                            <button
                                                class="btn btn-outline-danger rounded-pill px-2 py-0"
                                                style="height: 28px; font-size: 0.8rem;"
                                                th:attr="data-id=${khoaHoc.khoahocId}"
                                                onclick="xoaKhoaHoc(this, event)">
                                                <i
                                                    class="bi bi-trash me-1"></i>Xóa
                                            </button>
                                        </div>
                                    </li>
                                </th:block>
                            </ul>
                        </section>

                        <div th:if="${#lists.isEmpty(listDraft)}"
                            class="text-muted">Bạn chưa có khóa học nào.</div>
                    </div>

                    <div class="tab-pane fade" id="published" role="tabpanel">
                        <section class="mb-5 mt-3"
                            th:if="!${#lists.isEmpty(listPublished)}">
                            <div
                                class="section-header d-flex justify-content-between align-items-center mb-4 mt-4 px-3 py-2 border-start border-4 border-success">
                                <h4 class="fw-bold text-dark m-0">
                                    <i
                                        class="bi bi-check2-circle text-success me-2"></i>
                                    Khóa học đã xuất bản
                                </h4>
                            </div>
                            <div
                                class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
                                <div class="col"
                                    th:each="khoaHoc : ${listPublished}">
                                    <div class="khoa-hoc-card h-100 shadow-sm"
                                        th:onclick="|window.location.href='/noi-dung-khoa-hoc/${khoaHoc.khoahocId}?back=khoa-hoc-da-tao'|">
                                        <img th:if="${khoaHoc.anhBia != null}"
                                            th:src="${khoaHoc.anhBia}"
                                            alt="Ảnh khoá học">

                                        <div
                                            class="card-body d-flex flex-column pb-0">
                                            <h6 class="card-title"
                                                th:text="${khoaHoc.tenKhoaHoc}">Tên
                                                khóa học</h6>
                                        </div>

                                        <div class="card-footer pt-0">
                                            <div class="mb-3">
                                                <p
                                                    th:if="${khoaHoc.giaKhuyenMai != null and khoaHoc.giaKhuyenMai.doubleValue() > 0}"
                                                    class="card-text mb-0">
                                                    <span
                                                        class="fw-bold text-danger me-2"
                                                        th:text="${#numbers.formatDecimal(khoaHoc.giaKhuyenMai, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                                                    <del class="text-muted"
                                                        th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></del>
                                                </p>
                                                <p
                                                    th:if="${khoaHoc.giaKhuyenMai == null or khoaHoc.giaKhuyenMai.doubleValue() == 0}"
                                                    class="card-text fw-bold mb-0">
                                                    <span
                                                        th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                                                </p>
                                            </div>

                                            <div
                                                class="d-flex justify-content-center gap-3 pb-2">
                                                <button type="button"
                                                    onclick="event.stopPropagation()"
                                                    class="btn btn-outline-primary btn-sm share-btn py-1 px-2"
                                                    style="font-size: 12px;"
                                                    data-bs-toggle="modal"
                                                    th:data-bs-target="'#shareModal-' + ${khoaHoc.khoahocId}">
                                                    <i
                                                        class="fas fa-share me-1"></i>
                                                </button>

                                                <button type="button"
                                                    class="btn btn-outline-danger btn-sm py-1 px-2"
                                                    style="font-size: 12px;"
                                                    th:attr="data-id=${khoaHoc.khoahocId}"
                                                    onclick="xoaKhoaHoc(this, event)">
                                                    <i class="fas fa-trash-alt"
                                                        style="font-size: 12px;"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Modal chia sẻ -->
                                    <div class="modal fade"
                                        th:id="'shareModal-' + ${khoaHoc.khoahocId}"
                                        tabindex="-1" aria-hidden="true">
                                        <div
                                            class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header"
                                                    style="background-color: #e9f0ff; border-bottom: 2px solid #0d6efd;">
                                                    <h6 class="modal-title">
                                                        <i
                                                            class="fas fa-share-alt text-primary me-2"></i>
                                                        Chia sẻ khóa học:
                                                        <span
                                                            th:text="${khoaHoc.tenKhoaHoc}"></span>
                                                    </h6>
                                                    <button type="button"
                                                        class="btn-close"
                                                        data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                </div>
                                                <form
                                                    th:action="@{/studend/share-course}"
                                                    method="post"
                                                    class="ajax-form">
                                                    <div class="modal-body">
                                                        <input type="hidden"
                                                            name="courseId"
                                                            th:value="${khoaHoc.khoahocId}" />
                                                        <div class="mb-3">
                                                            <label
                                                                for="recipientEmail"
                                                                class="form-label">
                                                                <i
                                                                    class="fas fa-envelope text-primary me-2"></i>
                                                                Email người
                                                                nhận:
                                                            </label>
                                                            <input type="email"
                                                                name="recipientEmail"
                                                                class="form-control"
                                                                style="font-size: 14px;"
                                                                required
                                                                placeholder="nhapemail@example.com">
                                                        </div>
                                                        <p
                                                            style="font-size: 14px;">
                                                            <i
                                                                class="fas fa-info-circle text-info me-2"></i>
                                                            Email sẽ được gửi
                                                            kèm thông tin và
                                                            liên kết khóa học.
                                                        </p>
                                                    </div>
                                                    <div
                                                        class="ajax-message text-center px-3"></div>
                                                    <div class="modal-footer">
                                                        <div
                                                            class="d-flex justify-content-end gap-2 w-100">
                                                            <button
                                                                type="button"
                                                                class="btn btn-sm btn-outline-secondary"
                                                                data-bs-dismiss="modal">
                                                                <i
                                                                    class="fas fa-times me-1"></i>
                                                                Đóng
                                                            </button>
                                                            <button
                                                                type="submit"
                                                                class="btn btn-sm fw-semibold btn-outline-primary">
                                                                <i
                                                                    class="fas fa-paper-plane me-1"></i>
                                                                Gửi Email
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- end each -->
                            </div>
                            <!-- end row -->
                        </section>

                        <div th:if="${#lists.isEmpty(listPublished)}"
                            class="text-muted">Bạn chưa có khóa học nào.</div>
                    </div>

                    <!-- Đã gỡ -->
                    <div class="tab-pane fade" id="unpublished" role="tabpanel">
                        <section class="mb-5 mt-3"
                            th:if="!${#lists.isEmpty(listUnpublished)}">
                            <div
                                class="section-header mb-3 mt-4 px-3 py-2 border-start border-4 border-danger">
                                <h4 class="fw-bold text-dark m-0">
                                    <i
                                        class="bi bi-trash-fill text-danger me-2"></i>
                                    Khóa học đã xóa
                                </h4>
                            </div>
                            <div
                                class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
                                <div class="col"
                                    th:each="khoaHoc : ${listUnpublished}">
                                    <div class="khoa-hoc-card h-100 shadow-sm"
                                        th:onclick="|window.location.href='/noi-dung-khoa-hoc/${khoaHoc.khoahocId}?back=khoa-hoc-da-tao'|">
                                        <img th:if="${khoaHoc.anhBia != null}"
                                            th:src="${khoaHoc.anhBia}"
                                            alt="Ảnh khoá học">

                                        <div
                                            class="card-body d-flex flex-column pb-0">
                                            <h6 class="card-title"
                                                th:text="${khoaHoc.tenKhoaHoc}">Tên
                                                khóa học</h6>
                                        </div>

                                        <div class="card-footer pt-0">
                                            <div class="mb-3">
                                                <p
                                                    th:if="${khoaHoc.giaKhuyenMai != null and khoaHoc.giaKhuyenMai.doubleValue() > 0}"
                                                    class="card-text mb-0">
                                                    <span
                                                        class="fw-bold text-danger me-2"
                                                        th:text="${#numbers.formatDecimal(khoaHoc.giaKhuyenMai, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                                                    <del class="text-muted"
                                                        th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></del>
                                                </p>
                                                <p
                                                    th:if="${khoaHoc.giaKhuyenMai == null or khoaHoc.giaKhuyenMai.doubleValue() == 0}"
                                                    class="card-text fw-bold mb-0">
                                                    <span
                                                        th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                                                </p>
                                            </div>
                                            <div
                                                class="d-flex justify-content-center gap-3 pb-2">
                                                <button type="button"
                                                    class="btn btn-outline-success btn-sm py-1 px-2"
                                                    style="font-size: 12px;"
                                                    th:attr="data-id=${khoaHoc.khoahocId}"
                                                    onclick="hienModalMoLai(event, this)">
                                                    <i
                                                        class="fas fa-undo me-1"></i>
                                                    Mở lại khóa học
                                                </button>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <div th:if="${#lists.isEmpty(listUnpublished)}"
                            class="text-muted">Bạn chưa có khóa học nào.</div>
                    </div>

                </div>
            </div>

            <!-- Modal xác nhận xóa -->
            <div class="modal fade" id="modalXacNhanXoa" tabindex="-1"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-danger">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title">
                                <i
                                    class="fas fa-exclamation-triangle text-warning me-2"></i>Xác
                                nhận xóa khóa học 🔁
                            </h5>
                            <button type="button"
                                class="btn-close btn-close-white"
                                data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <i
                                class="fas fa-question-circle text-primary me-2"></i>
                            Bạn có chắc chắn muốn xóa khóa học này không? Hành
                            động này không thể hoàn tác.
                        </div>
                        <div class="modal-footer">
                            <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">
                                <i class="fas fa-times me-1"></i> Hủy
                            </button>
                            <button type="button" class="btn btn-outline-danger"
                                id="btnXacNhanXoa">
                                <i class="fas fa-trash-alt me-1"></i> Xóa
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Thông báo -->
            <div class="modal fade" id="modalThongBao" tabindex="-1"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header text-white"
                            style="background-color: #130377;">
                            <h6 class="modal-title">
                                <i
                                    class="fas fa-exclamation-circle text-warning me-2"></i>Thông
                                báo bạn vừa xóa 1 🔁 khóa học
                            </h6>
                            <button type="button" class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Đóng"></button>
                        </div>
                        <div class="modal-body text-center">
                            <!-- Nội dung sẽ được thay bằng JS -->
                            ...
                        </div>
                        <div class="modal-footer">
                            <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">
                                <i class="fas fa-times me-1"></i> Đóng
                            </button>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Modal xác nhận đã hủy -->
            <div class="modal fade" id="daHuyModal" tabindex="-1"
                aria-labelledby="daHuyModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title d-flex align-items-center"
                                id="daHuyModalLabel">
                                <i class="bi bi-bookmark-check-fill me-2"></i>
                                Thông báo hủy yêu cầu duyệt!
                            </h5>
                            <button type="button" class="btn-close text-white"
                                data-bs-dismiss="modal"
                                aria-label="Đóng"></button>
                        </div>
                        <div class="modal-body text-center">
                            <i
                                class="bi bi-check-circle-fill text-success fs-6 me-1"></i>
                            <span>
                                Khóa học của bạn đã được lưu vào <strong>Danh
                                    sách bản nháp</strong>.<br>
                                Bạn có thể truy cập để tiếp tục chỉnh sửa khóa
                                học!
                            </span>
                        </div>

                        <div class="modal-footer">
                            <button type="button"
                                class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">
                                <i class="bi bi-x-circle me-1"></i>Đóng
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal xác nhận mở lại khóa học -->
            <div class="modal fade" id="modalXacNhanMoLai" tabindex="-1"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Xác nhận</h5>
                            <button type="button" class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Đóng"></button>
                        </div>
                        <div class="modal-body">
                            Bạn có chắc chắn muốn <strong>mở lại khóa
                                học</strong> này không?
                        </div>
                        <div class="modal-footer">
                            <button type="button"
                                class="btn btn-secondary btn-sm"
                                data-bs-dismiss="modal">Hủy</button>
                            <button type="button" class="btn btn-success btn-sm"
                                id="btnXacNhanMoLai">Xác nhận</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal thông báo sau khi mở lại thành công -->

            <div class="modal fade" id="modalThongBaoThanhCong" tabindex="-1"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body text-center py-4">
                            <i
                                class="fas fa-check-circle text-success fs-1 mb-2"></i>
                            <p class="mb-0">Khóa học đã được mở lại và chuyển
                                trạng thái sang <strong>Đã xuất
                                    bản</strong>.</p>
                        </div>
                    </div>
                </div>
            </div>

            <script>
            let khoaHocIdDangMo = null;

            // Khi nhấn nút "Mở lại"
            function hienModalMoLai(event, button) {
                event.stopPropagation();

                khoaHocIdDangMo = button.getAttribute('data-id');
                const modal = new bootstrap.Modal(document.getElementById('modalXacNhanMoLai'));
                modal.show();
            }

            // Khi xác nhận mở lại khóa học
            document.getElementById('btnXacNhanMoLai').addEventListener('click', function() {
                if (!khoaHocIdDangMo) return;

                // Gửi yêu cầu mở lại khóa học (AJAX/fetch)
                fetch(`/api/khoahoc/mo-lai/${khoaHocIdDangMo}`, {
                        method: 'POST' // hoặc POST nếu backend dùng POST
                    })
                    .then(res => {
                        if (!res.ok) throw new Error("Không thể mở lại khóa học");
                        return res.text();
                    })
                    .then(data => {
                        // Ẩn modal xác nhận
                        bootstrap.Modal.getInstance(document.getElementById('modalXacNhanMoLai')).hide();

                        // Hiện modal thông báo thành công
                        const modalSuccess = new bootstrap.Modal(document.getElementById('modalThongBaoThanhCong'));
                        modalSuccess.show();

                        // Reload trang sau 1.5 giây (hoặc cập nhật trạng thái động)
                        setTimeout(() => {
                            window.location.reload();
                        }, 3000);
                    })
                    .catch(error => {
                        alert("Có lỗi xảy ra khi mở lại khóa học.");
                        console.error(error);
                    });
            });
        </script>

            <script>
            let khoaHocIdCanXoa = null;

            function xoaKhoaHoc(button, event) {
                event.stopPropagation();
                khoaHocIdCanXoa = button.getAttribute("data-id");

                const modal = new bootstrap.Modal(document.getElementById('modalXacNhanXoa'));
                modal.show();
            }

            document.addEventListener("DOMContentLoaded", () => {
                const btnXacNhanXoa = document.getElementById("btnXacNhanXoa");

                btnXacNhanXoa.addEventListener("click", () => {
                    if (!khoaHocIdCanXoa) return;

                    fetch(`/giangvien/xoa-khoa-hoc/${khoaHocIdCanXoa}`, {
                            method: 'POST'
                        })
                        .then(response => response.json())
                        .then(data => {
                            const modal = new bootstrap.Modal(document.getElementById('modalThongBao'));
                            document.querySelector('#modalThongBao .modal-body').textContent = data.message;
                            modal.show();

                            // Đóng modal xác nhận xóa
                            bootstrap.Modal.getInstance(document.getElementById('modalXacNhanXoa')).hide();

                            if (data.success) {
                                setTimeout(() => location.reload(), 5000);
                            }
                        })
                        .catch(error => {
                            console.error('Lỗi khi xóa khóa học:', error);
                        });
                });
            });
        </script>

            <script th:inline="javascript">
            document.addEventListener("DOMContentLoaded", function() {
                let daHuy = /*[[${daHuy}]]*/ false;
                if (daHuy) {
                    let myModal = new bootstrap.Modal(document.getElementById('daHuyModal'));
                    myModal.show();

                    // ✅ Xóa query string "?daHuy=true" khỏi URL sau khi hiển thị modal
                    const url = new URL(window.location);
                    url.searchParams.delete("daHuy");
                    window.history.replaceState({}, "", url.pathname + url.search);
                }
            });
        </script>
            <script>
            if (sessionStorage.getItem("isGoingBack") === "true") {
                localStorage.removeItem("customBackUrl");
                sessionStorage.removeItem("isGoingBack");
            }
        </script>

            <script>
            document.addEventListener("DOMContentLoaded", function() {
                const mainContent = document.querySelector(".khoahocdatao");
                if (mainContent) {
                    mainContent.classList.add("fade-slide-in"); // Có thể không cần nếu dùng `animation` trực tiếp trong class
                }
            });
        </script>

            <script>
            document.addEventListener("DOMContentLoaded", function() {
                const urlParams = new URLSearchParams(window.location.search);
                const selectedTab = urlParams.get('tab');

                if (selectedTab) {
                    const tabTrigger = document.querySelector(`[data-bs-target="#${selectedTab}"]`);
                    if (tabTrigger) {
                        const tab = new bootstrap.Tab(tabTrigger);
                        tab.show();

                        // Xóa ?tab=... khỏi URL sau khi chuyển tab
                        const newUrl = window.location.pathname;
                        window.history.replaceState({}, document.title, newUrl);
                    }
                }
            });
        </script>
        </main>
    </body>

</html>